generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String           @id
  email            String
  emailVerified    Boolean?
  name             String?
  image            String?
  createdAt        DateTime         @map("created_at")
  updatedAt        DateTime         @map("updated_at")
  role             String           @default("user")
  phoneNumber      String?          @map("phone_number")
  banned           Boolean          @default(false)
  banReason        String?          @map("ban_reason")
  banExpires       String?          @map("ban_expires")
  accounts         Account[]
  cards            Card[]
  emailLogs        EmailLog[]
  emailPreferences EmailPreference?
  payments         Payment[]
  profile          Profile?
  sessions         Session[]
  subscription     Subscription?
  teamMemberships  TeamMember[]
  ownedTeams       Team[]           @relation("teamOwner")
  conversations    Conversation[]

  @@index([email])
  @@map("users")
}

model Session {
  id             String   @id
  userId         String   @map("user_id")
  token          String
  expiresAt      DateTime @map("expires_at")
  createdAt      DateTime @map("created_at")
  updatedAt      DateTime @map("updated_at")
  ipAddress      String?  @map("ip_address")
  userAgent      String?  @map("user_agent")
  impersonatedBy String?  @map("impersonated_by")
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@map("sessions")
}

model Account {
  id                    String    @id
  userId                String    @map("user_id")
  accountId             String    @map("account_id")
  providerId            String    @map("provider_id")
  accessToken           String?   @map("access_token")
  refreshToken          String?   @map("refresh_token")
  accessTokenExpiresAt  DateTime? @map("access_token_expires_at")
  refreshTokenExpiresAt DateTime? @map("refresh_token_expires_at")
  scope                 String?
  idToken               String?   @map("id_token")
  password              String?
  createdAt             DateTime  @map("created_at")
  updatedAt             DateTime  @map("updated_at")
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
  @@index([userId])
  @@map("accounts")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime  @map("expires_at")
  createdAt  DateTime? @map("created_at")
  updatedAt  DateTime? @map("updated_at")

  @@index([identifier])
  @@map("verifications")
}

model Profile {
  id          String        @id @default(cuid())
  userId      String        @unique @map("user_id")
  username    String        @unique
  email       String
  firstName   String?       @map("first_name")
  lastName    String?       @map("last_name")
  fullName    String?       @map("full_name")
  phoneNumber String?       @map("phone_number")
  bio         String?
  avatarUrl   String?       @map("avatar_url")
  website     String?
  location    String?
  company     String?
  jobTitle    String?       @map("job_title")
  isActive    Boolean       @default(true) @map("is_active")
  createdAt   DateTime      @map("created_at")
  updatedAt   DateTime      @map("updated_at")
  views       ProfileView[]
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([email])
  @@map("profiles")
}

model Card {
  id          String    @id @default(cuid())
  userId      String    @map("user_id")
  cardId      String    @unique @map("card_id")
  cardName    String    @map("card_name")
  cardType    String    @default("standard") @map("card_type")
  isActive    Boolean   @default(false) @map("is_active")
  activatedAt DateTime? @map("activated_at")
  expiresAt   DateTime? @map("expires_at")
  createdAt   DateTime  @map("created_at")
  updatedAt   DateTime  @map("updated_at")
  formData    Json?     @map("form_data")
  templateId  Int?      @map("template_id")
  views       CardView[]
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isActive])
  @@map("cards")
}

model Payment {
  id            String    @id @default(cuid())
  userId        String    @map("user_id")
  reference     String    @unique
  amount        Decimal   @db.Decimal(10, 2)
  currency      String    @default("NGN")
  status        String    @default("pending")
  paymentMethod String?   @map("payment_method")
  paymentType   String    @map("payment_type")
  metadata      Json?
  paidAt        DateTime? @map("paid_at")
  createdAt     DateTime  @map("created_at")
  updatedAt     DateTime  @map("updated_at")
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@map("payments")
}

model Subscription {
  id               String    @id @default(cuid())
  userId           String    @unique @map("user_id")
  planId           String    @map("plan_id")
  planName         String    @map("plan_name")
  status           String    @default("inactive")
  subscriptionCode String?   @map("subscription_code")
  emailToken       String?   @map("email_token")
  startDate        DateTime? @map("start_date")
  nextBillingDate  DateTime? @map("next_billing_date")
  expiryDate       DateTime? @map("expiry_date")
  cancelledAt      DateTime? @map("cancelled_at")
  createdAt        DateTime  @map("created_at")
  updatedAt        DateTime  @map("updated_at")
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@map("subscriptions")
}

model ProfileView {
  id              String   @id @default(cuid())
  profileId       String   @map("profile_id")
  viewerIp        String?  @map("viewer_ip")
  viewerUserAgent String?  @map("viewer_user_agent")
  viewerLocation  String?  @map("viewer_location")
  referrer        String?
  createdAt       DateTime @map("created_at")
  profile         Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([createdAt])
  @@map("profile_views")
}

model EmailLog {
  id        String   @id @default(cuid())
  userId    String?  @map("user_id")
  to        String
  from      String
  subject   String
  emailType String   @map("email_type")
  status    String   @default("sent")
  metadata  Json?
  sentAt    DateTime @map("sent_at")
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([emailType])
  @@index([sentAt])
  @@map("email_logs")
}

model EmailPreference {
  id                    String   @id @default(cuid())
  userId                String   @unique @map("user_id")
  welcomeEmails         Boolean  @default(true) @map("welcome_emails")
  activityNotifications Boolean  @default(true) @map("activity_notifications")
  weeklyReports         Boolean  @default(true) @map("weekly_reports")
  marketingEmails       Boolean  @default(false) @map("marketing_emails")
  paymentNotifications  Boolean  @default(true) @map("payment_notifications")
  securityAlerts        Boolean  @default(true) @map("security_alerts")
  createdAt             DateTime @map("created_at")
  updatedAt             DateTime @map("updated_at")
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("email_preferences")
}

model EmailOptOut {
  id        String   @id @default(cuid())
  email     String   @unique
  reason    String?
  createdAt DateTime @map("created_at")

  @@map("email_opt_outs")
}

model Team {
  id          String       @id @default(cuid())
  name        String
  description String?
  ownerId     String       @map("owner_id")
  createdAt   DateTime     @map("created_at")
  updatedAt   DateTime     @map("updated_at")
  members     TeamMember[]
  owner       User         @relation("teamOwner", fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([ownerId])
  @@map("teams")
}

model TeamMember {
  id       String   @id @default(cuid())
  teamId   String   @map("team_id")
  userId   String   @map("user_id")
  role     String   @default("member")
  joinedAt DateTime @map("joined_at")
  team     Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@index([teamId])
  @@index([userId])
  @@map("team_members")
}

model CardView {
  id        String   @id @default(cuid())
  cardId    String
  card      Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
  ip        String?
  userAgent String?
  browser   String?
  os        String?
  device    String?
  country   String?
  city      String?
  createdAt DateTime @default(now())

  @@index([cardId])
}

model Conversation {
  id        String    @id @default(cuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages  Message[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([userId])
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  content        String
  isFromAdmin    Boolean      @default(false)
  createdAt      DateTime     @default(now())
  read           Boolean      @default(false)

  @@index([conversationId])
}
